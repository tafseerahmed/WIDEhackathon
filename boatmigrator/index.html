<!DOCTYPE html>
<meta charset="utf-8">
<html>
    <head>
        <title>Rowboat</title>
    </head>

    <body>
        <form id="form">
            <input type="text" name="subject" id="subject">
            <input type="submit" value="Submit">
        </form>

        <div id="asd"></div>

        <script src="//cdnjs.cloudflare.com/ajax/libs/d3/4.3.0/d3.min.js"></script>    
        <script>
            var projection = d3
                .geoMercator()
                .scale(1500)
                .center([24.9435, 67.1666]);

            var path = d3.geoPath().projection(projection);ã€€

            var map = d3.select("body")
                .append("svg")
                .attr("width", 960)
                .attr("height", 800);
            
            d3.json("finland.geojson", drawMaps);
            
            function drawMaps(geojson) {
                map.selectAll("path")
                    .data(geojson.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("fill", "green")
                    .attr("fill-opacity", 0.5)
                    .attr("stroke", "#222");    
            }

            function drawMigration(geojson) {
                console.log(geojson);
                map.selectAll("circle")
                    .data(geojson).enter()
                    .append("circle")
                    .attr("cx", function (d) { return projection(d)[0]; })
                    .attr("cy", function (d) { return projection(d)[1]; })
                    .attr("r", "4px")
                    .attr("fill", "red")
            }

            document.querySelector("#form").addEventListener("submit",
                function(e) {
                    var xmlhttp = new XMLHttpRequest();
                    var subject = document.getElementById("subject").value;
                    var url = "/api/" + subject;
                    d3.json(url, drawMigration);
                    
                    /*xmlhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            var data = JSON.parse(this.responseText);
                            

                            var out = "";
                            for(var i = 0; i < data.length; i++) {
                                out += data[i] + '<br>';
                            }
                            document.getElementById("asd").innerHTML = out;
                        }
                    };

                    xmlhttp.open("GET", url, true);
                    xmlhttp.send();*/

                    e.preventDefault();
                }
            );
        </script>
    </body>
</html>